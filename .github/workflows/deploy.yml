name: Deploy

on:
  workflow_call:
    inputs:
      config-path:
        required: true
        type: string
    env:
      deployment-env:
        required: true


jobs:
  ci:
    uses: ./.github/workflows/continuous-integration.yml

  deploy:
    needs: [ci]
    steps:
      - uses: actions/checkout@v3

      - name: publish
        runs-on: ubuntu-latest
        environment: ${{env.deployment-env}}
        env:
          pypi: ${{ env.PYPI_URL }}
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          repository-url: ${{env.pypi}}
